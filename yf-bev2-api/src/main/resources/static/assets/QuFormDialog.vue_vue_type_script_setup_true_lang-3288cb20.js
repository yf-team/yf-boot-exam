import{_ as e}from"./DictListSelect.vue_vue_type_script_setup_true_lang-2040b1f2.js";import{L as l,d as a,r as t,M as u,I as s,y as d,z as i,o,i as n,w as r,g as p,f as v,s as f,a as m,t as c,N as _,A as g,K as y}from"./index-6345b1a2.js";import{_ as h}from"./RepoSelect.vue_vue_type_script_setup_true_lang-b51464c2.js";import{_ as w}from"./style.css_vue_type_style_index_0_src_true_lang-11b42eb2.js";const b={style:{"padding-bottom":"10px"}},V={class:"dialog-footer"},L=a({__name:"QuFormDialog",props:{visible:{type:Boolean,default:!1},repoId:{type:String,default:""},quId:{type:String,default:""}},emits:["update:visible","saved"],setup(a,{emit:L}){const q=a,x=t(!1),I=t(!1),R=t({answerList:[]}),U=t(),k=u({quType:[{required:!0,message:"题型不能为空",trigger:"blur"}],repoId:[{required:!0,message:"题库必须选择！",trigger:"blur"}],content:[{required:!0,message:"题干必须填写！",trigger:"blur"}]});s((()=>q.visible),(e=>{x.value=e})),s((()=>q.quId),(e=>{e?j(e):R.value={}})),s((()=>q.repoId),(e=>{R.value.repoId=e})),s((()=>R.value.quType),(e=>{e&&$(e)}));const T=()=>{x.value=!1,L("update:visible",!1)},C=async e=>{e&&await(null==e?void 0:e.validate((async a=>{var t;a&&D()&&(I.value=!0,(t=R.value,l.post({url:"/api/exam/repo/qu/save",data:t})).then((()=>{y({message:"题目添加成功！",type:"success"}),x.value=!1,L("update:visible",!1),L("saved"),I.value=!1,null==e||e.resetFields(),R.value.repoId=q.repoId})).catch((()=>{I.value=!1})))})))},j=e=>{var a;(a={id:e},l.post({url:"/api/exam/repo/qu/detail",data:a})).then((({data:e})=>{R.value=e}))},S=()=>{R.value.answerList||(R.value.answerList=[]),R.value.answerList.push({content:"",isRight:!1})},$=e=>{var l,a,t;if(!R.value.id){if(R.value.answerList=[],"radio"===e||"multi"===e)for(let e=0;e<3;e++)null==(l=R.value.answerList)||l.push({content:"",isRight:!1});"judge"===e&&(null==(a=R.value.answerList)||a.push({content:"正确",isRight:!1}),null==(t=R.value.answerList)||t.push({content:"错误",isRight:!1}))}},D=()=>{let e=0,l=0;if(R.value.answerList&&R.value.answerList.length>0)for(let a=0;a<R.value.answerList.length;a++){R.value.answerList[a].isRight&&(l+=1),e+=1}return 0===e?(y({message:"选项列表不能为空！",type:"error"}),!1):0!==l||(y({message:"请至少选择一个选项作为正确答案！",type:"error"}),!1)};return d((()=>{q.quId&&j(q.quId)})),(l,a)=>{const t=i("el-form-item"),u=i("el-col"),s=i("el-row"),d=i("el-divider"),y=i("el-button"),L=i("el-table-column"),q=i("el-checkbox"),j=i("el-input"),$=i("el-table"),D=i("el-form"),F=i("el-dialog");return o(),n(F,{modelValue:x.value,"onUpdate:modelValue":a[6]||(a[6]=e=>x.value=e),"before-close":T,"align-center":"",title:"试题管理",width:"80%"},{footer:r((()=>[p("span",V,[v(y,{onClick:T},{default:r((()=>[f("取消")])),_:1}),v(y,{loading:I.value,type:"primary",onClick:a[5]||(a[5]=e=>C(U.value))},{default:r((()=>[f("保存")])),_:1},8,["loading"])])])),default:r((()=>[v(D,{ref_key:"formRef",ref:U,model:R.value,rules:k,"label-width":"120px"},{default:r((()=>[v(s,{gutter:20},{default:r((()=>[v(u,{span:12},{default:r((()=>[v(t,{label:"试题题型",prop:"quType"},{default:r((()=>[v(m(e),{modelValue:R.value.quType,"onUpdate:modelValue":a[0]||(a[0]=e=>R.value.quType=e),disabled:!!R.value.id,"dic-code":"qu_type"},null,8,["modelValue","disabled"])])),_:1})])),_:1}),v(u,{span:12},{default:r((()=>[v(t,{label:"难度等级",prop:"difficultyLevel"},{default:r((()=>[v(m(e),{modelValue:R.value.difficultyLevel,"onUpdate:modelValue":a[1]||(a[1]=e=>R.value.difficultyLevel=e),"dic-code":"qu_difficulty_level"},null,8,["modelValue"])])),_:1})])),_:1}),v(u,{span:12},{default:r((()=>[v(t,{label:"所属题库",prop:"repoId"},{default:r((()=>[v(h,{modelValue:R.value.repoId,"onUpdate:modelValue":a[2]||(a[2]=e=>R.value.repoId=e)},null,8,["modelValue"])])),_:1})])),_:1}),v(u,{span:24},{default:r((()=>[v(t,{label:"试题题干",prop:"content"},{default:r((()=>[v(w,{ref:"editorRef",modelValue:R.value.content,"onUpdate:modelValue":a[3]||(a[3]=e=>R.value.content=e),height:"100px"},null,8,["modelValue"])])),_:1})])),_:1}),v(u,{span:24},{default:r((()=>[v(t,{label:"试题解析",prop:"analysis"},{default:r((()=>[v(w,{ref:"analysisRef",modelValue:R.value.analysis,"onUpdate:modelValue":a[4]||(a[4]=e=>R.value.analysis=e),height:"100px"},null,8,["modelValue"])])),_:1})])),_:1})])),_:1}),R.value.quType?(o(),n(u,{key:0,span:24},{default:r((()=>[v(d),p("div",b,[v(y,{type:"primary",onClick:S},{default:r((()=>[f("添加选项")])),_:1})]),v($,{data:R.value.answerList,border:"",style:{width:"100%"}},{default:r((()=>[v(L,{label:"序号",width:"180"},{default:r((({$index:e})=>[f("第"+c(e+1)+"项",1)])),_:1}),v(L,{align:"center",label:"是否答案",width:"180"},{default:r((({row:e,$index:l})=>[v(q,{modelValue:e.isRight,"onUpdate:modelValue":l=>e.isRight=l,label:"答案",onChange:e=>((e,l)=>{if(R.value.answerList&&0!==R.value.answerList.length&&e&&("radio"===R.value.quType||"judge"===R.value.quType))for(let a=0;a<R.value.answerList.length;a++)l!==a&&(R.value.answerList[a].isRight=!1)})(e,l)},null,8,["modelValue","onUpdate:modelValue","onChange"])])),_:1}),v(L,{label:"答案内容"},{default:r((({row:e})=>[v(j,{modelValue:e.content,"onUpdate:modelValue":l=>e.content=l,placeholder:"输入选项内容"},null,8,["modelValue","onUpdate:modelValue"])])),_:1}),v(L,{align:"center",label:"操作项",width:"180px"},{default:r((({$index:e})=>[v(y,{icon:m(_),circle:"",type:"danger",onClick:l=>{return a=e,void(null==(t=R.value.answerList)||t.splice(a,1));var a,t}},null,8,["icon","onClick"])])),_:1})])),_:1},8,["data"])])),_:1})):g("",!0)])),_:1},8,["model","rules"])])),_:1},8,["modelValue"])}}});export{L as _};
