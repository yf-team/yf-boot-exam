import{_ as e}from"./ContentWrap.vue_vue_type_script_setup_true_lang-d6cd8ae8.js";import{s as l}from"./index-7455f1af.js";import{d as t,r as a,y as o,z as d,m as r,p as s,o as i,c as n,g as u,f as c,w as p,s as m,i as v,A as f,F as y,G as h,a3 as k,t as g,a as _,P as b,a6 as x,L as w,K as C,B as j,_ as N,M as U}from"./index-6345b1a2.js";/* empty css                   *//* empty css                  *//* empty css                 *//* empty css                */import"./el-tooltip-4ed993c7.js";/* empty css                  */const V={"element-loading-text":"加载中..."},B={class:"search-box"},D={class:"search-items"},z={class:"opt-box"},A={class:"opt-box-left"},E={class:"opt-box-right"},I={class:"tree-box"},T=N(t({__name:"DataTree",props:{columns:{type:Array,default:()=>[]},filterKey:{type:String,default:"title"},allowDrop:Function,add:Boolean,edit:Boolean,delete:Boolean,sort:Boolean,treeUrl:String,sortUrl:String,deleteUrl:String},emits:["onAdd","onEdit","onDelete","onBatch"],setup(e,{expose:l,emit:t}){const N=e,U=a([]),T=a(!1),S=a(""),K=()=>{T.value=!0,w.post({url:N.treeUrl}).then((e=>{U.value=e.data,T.value=!1})).catch((()=>{T.value=!1}))},L=e=>{t("onEdit",e)},P=a([]),R=a(),O=(e,l)=>{if(0===e)return"flex-grow: 1";return`width: ${P.value[e]}px; justify-content: ${l?"center":"left"}`},W=e=>{e&&0!=e.length?j.confirm("确实要删除吗?","提示信息",{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning"}).then((()=>{w.post({url:N.deleteUrl,data:{ids:e}}).then((()=>{C({showClose:!0,message:"删除成功！",type:"success"}),K()}))})):C.error("请至少勾选一个数据！")},F=(e,l,t)=>{const a={form:e.data.id,to:l.data.id,dropType:t};w.post({url:N.sortUrl,data:a}).then((()=>{C({showClose:!0,message:"排序成功！",type:"success"}),K()}))},M=a(),$=(e,l)=>!e||l[N.filterKey].includes(e),q=()=>{P.value=[];let e=768;R.value&&R.value&&R.value.clientWidth&&(e=R.value.clientWidth);let l=0;for(let a=0;a<N.columns.length;a++)l+=N.columns[a].width,P.value[a]=N.columns[a].width;const t=e/l;for(let a=0;a<P.value.length;a++)P.value[a]=P.value[a].valueOf()*t;P.value.push(t*(100-l))};return o((()=>{q(),K(),window.addEventListener("resize",q)})),l({reload:()=>{K()}}),(e,l)=>{const a=d("el-input"),o=d("el-button"),w=r("loading");return s((i(),n("div",V,[u("div",B,[u("div",D,[c(a,{modelValue:S.value,"onUpdate:modelValue":l[0]||(l[0]=e=>S.value=e),class:"filter-item",placeholder:"搜索关键字"},null,8,["modelValue"])]),c(o,{icon:"Search",type:"primary",onClick:l[1]||(l[1]=e=>{M.value.filter(S.value)})},{default:p((()=>[m("搜索")])),_:1}),c(o,{icon:"RefreshLeft",onClick:l[2]||(l[2]=e=>(S.value="",void M.value.filter(S.value)))},{default:p((()=>[m("重置")])),_:1})]),u("div",z,[u("div",A,[N.add?(i(),v(o,{key:0,icon:"Plus",type:"primary",onClick:l[3]||(l[3]=e=>{t("onAdd")})},{default:p((()=>[m("添加 ")])),_:1})):f("",!0),N.edit?(i(),v(o,{key:1,icon:"Edit",type:"success",onClick:l[4]||(l[4]=e=>(()=>{const e=M.value.getCurrentNode();e?L(e):C.error("请选择一条数据再编辑！")})())},{default:p((()=>[m("修改 ")])),_:1})):f("",!0),N.delete?(i(),v(o,{key:2,icon:"Delete",type:"danger",onClick:l[5]||(l[5]=e=>(()=>{const e=M.value.getCheckedKeys(!1);W(e)})())},{default:p((()=>[m("删除 ")])),_:1})):f("",!0)]),u("div",E,[c(o,{circle:"",icon:"Refresh",size:"small",onClick:K})])]),u("div",{ref_key:"treeHeader",ref:R,class:"header-box"},[(i(!0),n(y,null,h(N.columns,((e,l)=>(i(),n("div",{key:l,style:k(O(l,e.center||!1)),class:"tree-header"},g(e.title),5)))),128)),N.add||N.edit||N.delete?(i(),n("div",{key:0,style:k(O(N.columns.length,!0)),class:"tree-header"},"操作项 ",4)):f("",!0)],512),c(_(x),{ref_key:"treeRef",ref:M,"allow-drop":N.allowDrop,data:U.value,"expand-on-click-node":!1,"filter-node-method":$,"default-expand-all":"",draggable:"","highlight-current":"","node-key":"id","show-checkbox":"",onNodeDrop:F},{default:p((({data:e})=>[u("div",I,[(i(!0),n(y,null,h(N.columns,((l,t)=>(i(),n("div",{key:t,style:k(O(t,l.center||!1)),class:"tree-item"},[l.icon?(i(),v(_(b),{key:0,icon:e[l.icon]},null,8,["icon"])):f("",!0),m(" "+g(e[l.prop]),1)],4)))),128)),N.add||N.edit||N.delete?(i(),n("div",{key:0,style:k(O(N.columns.length,!0)),class:"tree-item"},[N.add?(i(),v(o,{key:0,disabled:!e.id,circle:"",icon:"Plus",size:"small",onClick:l=>{t("onAdd",e)}},null,8,["disabled","onClick"])):f("",!0),N.edit?(i(),v(o,{key:1,disabled:!e.id,circle:"",icon:"Edit",size:"small",onClick:l=>L(e)},null,8,["disabled","onClick"])):f("",!0),N.delete?(i(),v(o,{key:2,disabled:!e.id,circle:"",icon:"Delete",size:"small",type:"danger",onClick:l=>W([e.id])},null,8,["disabled","onClick"])):f("",!0)],4)):f("",!0)])])),_:1},8,["allow-drop","data"])])),[[w,T.value]])}}}),[["__scopeId","data-v-9c9ce99f"]]),S={class:"dialog-footer"},K=t({__name:"Depart",setup(t){const o=a(),n=a(!1);let f=a([{title:"部门名称",prop:"deptName",center:!1,width:50},{title:"部门编号",prop:"deptCode",center:!1,width:40}]);const y=a(!1),h=a({parentId:"0",deptName:""}),k=a(),g=U({deptName:[{required:!0,message:"部门名称不能为空！",trigger:"blur"}]}),b=e=>{e&&e.id?h.value.parentId=e.id:h.value.parentId="0",y.value=!0},x=e=>{h.value=e,y.value=!0},w=()=>{y.value=!1},C=(e,l,t)=>e.data.parentId===l.data.parentId&&"inner"!==t;return(t,a)=>{const j=d("el-input"),N=d("el-form-item"),U=d("el-form"),V=d("el-button"),B=d("el-dialog"),D=r("loading");return s((i(),v(_(e),{"element-loading-text":"加载中..."},{default:p((()=>[c(T,{ref_key:"dataTree",ref:o,columns:_(f),"filter-key":"deptName","allow-drop":C,add:!0,edit:!0,delete:!0,sort:!0,"tree-url":"/api/sys/depart/tree","delete-url":"/api/sys/depart/delete","sort-url":"/api/sys/depart/sort",onOnAdd:b,onOnEdit:x},null,8,["columns"]),c(B,{modelValue:y.value,"onUpdate:modelValue":a[3]||(a[3]=e=>y.value=e),title:"管理部门",width:"35%","before-close":w},{footer:p((()=>[u("span",S,[c(V,{onClick:a[1]||(a[1]=e=>y.value=!1)},{default:p((()=>[m("取消")])),_:1}),c(V,{type:"primary",onClick:a[2]||(a[2]=e=>{var t;(t=k.value)&&t.validate((e=>{e&&l(h.value).then((()=>{y.value=!1,o.value.reload()}))}))})},{default:p((()=>[m("保存")])),_:1})])])),default:p((()=>[c(U,{model:h.value,rules:g,ref_key:"formRef",ref:k,"label-width":"120px"},{default:p((()=>[c(N,{label:"部门名称",prop:"deptName"},{default:p((()=>[c(j,{modelValue:h.value.deptName,"onUpdate:modelValue":a[0]||(a[0]=e=>h.value.deptName=e),autocomplete:"off"},null,8,["modelValue"])])),_:1})])),_:1},8,["model","rules"])])),_:1},8,["modelValue"])])),_:1})),[[D,n.value]])}}});export{K as default};
