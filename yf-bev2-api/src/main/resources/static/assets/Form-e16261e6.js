import{d as e,u as l,r as a,x as t,M as u,I as o,e as d,y as n,z as r,o as s,i,w as p,f as m,s as c,g as f,a as _,K as v,C as V,D as b,_ as y}from"./index-20708d06.js";import{_ as q}from"./style.css_vue_type_style_index_0_src_true_lang-5ff1785b.js";import{_ as g}from"./ContentWrap.vue_vue_type_script_setup_true_lang-d93320da.js";import{_ as h}from"./RepoSelect.vue_vue_type_script_setup_true_lang-7c28ae7b.js";import{s as T}from"./index-92fe755e.js";import{s as x,a as C}from"./index-2eedb9be.js";import"./el-tooltip-4ed993c7.js";/* empty css                  */const S=e=>(V("data-v-0f5cacba"),e=e(),b(),e),U=S((()=>f("h3",null,"考试信息",-1))),w=S((()=>f("h3",null,"组卷信息",-1))),M=S((()=>f("div",{style:{"font-size":"12px",color:"#2d8cf0","padding-bottom":"10px"}},"* 不需要抽取的题型抽题数量设置为0即可 ",-1))),j={style:{"padding-top":"20px"}},I=y(e({__name:"Form",setup(e){const{replace:V}=l(),b=a(!1),y=t().query.id||"",S=a({repoId:"",chance:0,handMin:0,lateMax:0,totalTime:5,startTime:"",endTime:""}),I=a(),Y=u({title:[{required:!0,message:"考试名称必须填写！",trigger:"blur"}],endTime:[{required:!0,message:"考试时间不能为空！",trigger:"blur"}],repoId:[{required:!0,message:"题库必须选择！",trigger:"blur"}],totalTime:[{type:"number",required:!0,asyncValidator:(e,l)=>new Promise(((e,a)=>{l<1?a("考试时长必须大于1分钟！"):e()}))}],qualifyScore:[{required:!0,message:"及格分不能为空！",trigger:"blur"}],totalScore:[{type:"number",required:!0,asyncValidator:(e,l)=>new Promise(((e,a)=>{l<1?a("总分数不能等于0，请调整组卷策略！"):e()}))}]});o((()=>S.value.repoId),((e,l)=>{T({id:e}).then((e=>{L(e.data,!l)}))})),o((()=>S.value.ruleList),(e=>{let l=0;if(e&&e.length>0)for(let a=0;a<e.length;a++){const t=e[a];l+=(t.quCount??0)*(t.quScore??0)}S.value.totalScore=l}),{deep:!0});const L=(e,l)=>{const a=[];for(let t=0;t<e.length;t++){const u=e[t];let o={totalCount:u.quCount,quScore:0,quCount:0,quType:u.quType,quType_dictText:u.quType_dictText};if(S.value.id&&l){const e=S.value.ruleList;if(e&&e.length>0)for(let l=0;l<e.length;l++){const a=e[l];u.quType===a.quType&&(o.quCount=a.quCount,o.quScore=a.quScore)}}a.push(o)}S.value.ruleList=a},R=d({get:()=>[S.value.startTime,S.value.endTime],set:e=>{S.value.startTime=(null==e?void 0:e[0])||"",S.value.endTime=(null==e?void 0:e[1])||""}});return n((()=>{y&&C({id:y}).then((({data:e})=>{S.value=e}))})),(e,l)=>{const a=r("el-input"),t=r("el-form-item"),u=r("el-col"),o=r("el-date-picker"),d=r("el-input-number"),n=r("el-table-column"),y=r("el-table"),T=r("el-row"),C=r("el-form"),L=r("el-button");return s(),i(_(g),null,{default:p((()=>[U,m(C,{ref_key:"formRef",ref:I,model:S.value,rules:Y,"label-width":"120px"},{default:p((()=>[m(T,{gutter:20},{default:p((()=>[m(u,{span:12},{default:p((()=>[m(t,{label:"考试名称",prop:"title"},{default:p((()=>[m(a,{modelValue:S.value.title,"onUpdate:modelValue":l[0]||(l[0]=e=>S.value.title=e),autocomplete:"off"},null,8,["modelValue"])])),_:1})])),_:1}),m(u,{span:12},{default:p((()=>[m(t,{label:"考试时间",prop:"endTime"},{default:p((()=>[m(o,{modelValue:R.value,"onUpdate:modelValue":l[1]||(l[1]=e=>R.value=e),"range-separator":"到",type:"datetimerange","value-format":"YYYY-MM-DD HH:mm:ss"},null,8,["modelValue"])])),_:1})])),_:1}),m(u,{span:12},{default:p((()=>[m(t,{label:"总分数",prop:"totalScore"},{default:p((()=>[m(d,{modelValue:S.value.totalScore,"onUpdate:modelValue":l[2]||(l[2]=e=>S.value.totalScore=e),disabled:""},null,8,["modelValue"]),c(" 分 ")])),_:1})])),_:1}),m(u,{span:12},{default:p((()=>[m(t,{label:"及格分",prop:"qualifyScore"},{default:p((()=>[m(d,{modelValue:S.value.qualifyScore,"onUpdate:modelValue":l[3]||(l[3]=e=>S.value.qualifyScore=e)},null,8,["modelValue"]),c(" 分 ")])),_:1})])),_:1}),m(u,{span:12},{default:p((()=>[m(t,{label:"考试时长",prop:"totalTime"},{default:p((()=>[m(d,{modelValue:S.value.totalTime,"onUpdate:modelValue":l[4]||(l[4]=e=>S.value.totalTime=e),min:1},null,8,["modelValue"]),c(" 分钟 ")])),_:1})])),_:1}),m(u,{span:12},{default:p((()=>[m(t,{label:"考试机会"},{default:p((()=>[m(d,{modelValue:S.value.chance,"onUpdate:modelValue":l[5]||(l[5]=e=>S.value.chance=e),min:0},null,8,["modelValue"]),c(" 次 ")])),_:1})])),_:1}),m(u,{span:12},{default:p((()=>[m(t,{label:"允许迟到时长"},{default:p((()=>[m(d,{modelValue:S.value.lateMax,"onUpdate:modelValue":l[6]||(l[6]=e=>S.value.lateMax=e),min:0},null,8,["modelValue"]),c(" 分钟 ")])),_:1})])),_:1}),m(u,{span:12},{default:p((()=>[m(t,{label:"最低交卷时间"},{default:p((()=>[m(d,{modelValue:S.value.handMin,"onUpdate:modelValue":l[7]||(l[7]=e=>S.value.handMin=e),min:0},null,8,["modelValue"]),c(" 分钟 ")])),_:1})])),_:1}),m(u,{span:24},{default:p((()=>[m(t,{label:"考试说明",prop:"content"},{default:p((()=>[m(q,{ref:"editorRef",modelValue:S.value.content,"onUpdate:modelValue":l[8]||(l[8]=e=>S.value.content=e),height:"100px",style:{width:"100%"}},null,8,["modelValue"])])),_:1})])),_:1}),m(u,{span:24},{default:p((()=>[w,m(t,{label:"抽题题库",prop:"repoId"},{default:p((()=>[m(h,{modelValue:S.value.repoId,"onUpdate:modelValue":l[9]||(l[9]=e=>S.value.repoId=e)},null,8,["modelValue"])])),_:1}),M,m(y,{data:S.value.ruleList,border:"",style:{width:"100%"}},{default:p((()=>[m(n,{label:"题型",prop:"quType_dictText"}),m(n,{label:"总题数",prop:"totalCount"}),m(n,{label:"抽取题数"},{default:p((({row:e})=>[m(d,{modelValue:e.quCount,"onUpdate:modelValue":l=>e.quCount=l,disabled:0===e.totalCount,max:e.totalCount},null,8,["modelValue","onUpdate:modelValue","disabled","max"])])),_:1}),m(n,{label:"每题分数"},{default:p((({row:e})=>[m(d,{modelValue:e.quScore,"onUpdate:modelValue":l=>e.quScore=l,disabled:0===e.totalCount||0===e.quCount},null,8,["modelValue","onUpdate:modelValue","disabled"])])),_:1})])),_:1},8,["data"])])),_:1})])),_:1})])),_:1},8,["model","rules"]),f("div",j,[m(L,{loading:b.value,type:"primary",onClick:l[10]||(l[10]=e=>(async e=>{e&&await(null==e?void 0:e.validate((async e=>{e&&(b.value=!0,x(S.value).then((()=>{v({message:"考试保存成功！",type:"success"}),b.value=!1,V({name:"Exam"})})).catch((()=>{b.value=!1})))})))})(I.value))},{default:p((()=>[c("保存")])),_:1},8,["loading"])])])),_:1})}}}),[["__scopeId","data-v-0f5cacba"]]);export{I as default};
